<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Studienarbeit EEBus</title>
</head>
<body>
    <input type="text" id="input" autocomplete="off">
    <button id="send">Send</button>

    <script>

        var input = document.querySelector('#input');
        var button = document.querySelector('#send');
        
        function WsClient(url) {
            this.wss =new WebSocket(url);
            this.addEventListener = {};

            this.on = (eventName, cb) => this.addEventListener[eventName] =cb;

            this.emit = (name, data) => {
                let event = {
                    event: name,
                    data: data
                };
                let rawData = JSON.stringify(event);
                this.wss.send(rawData);
            };

            this.wss.onmessage = (response) => {
                try{
                    let data = JSON.parse(response.data);
                    if (data){
                        let cb = this.addEventListener[data.event];
                        if (cb)
                            cb(data.data);

                    }
                } catch(e) {
                    window.alert(e);
                }
            }
        }

        var wss = new WsClient('ws://' + window.location.origin.replace(/((http)|(https)):\/\//gm, '') + '/ws');

        wss.on('response', (data) => {
            console.log("response:", data);
            msg.innerText =data;
            document.body.appendChild(msg);
        })

        button.onclick = () => {
            wss.emit('message', input.value)
        };
    </script>
</body>
</html>